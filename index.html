<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kata Lispy Lang</title>
    <script src="lang.js"></script>
</head>

<body>
    <script id="src" type="text/lisp">

    ;(module Math
    ;    """
    ;    A doc comment.
    ;    with some escaped \""" stuff
    ;    """
    ;    (import Prelude *)
    ;    (import Platform/Js :as js)
    ;    (export pi square)

    ;    ; A line comment
    ;    (let
    ;        pi 3.14159265
    ;        literal "A string with ; and escaped \" stuff"
    ;        msg { :type "do_it" :payload { :one 1 } }
    ;    )

    ;    (fn square [x] (* x x))

    ;    (js/console.log literal (square 2))
    ;)

    (module ;:main
        (import Prelude + map)
        (import Unsafe/ECMAScript :as js)
        (fn inc [x] (+ x 1))
        (let
            almost-pi (inc 2.14159265)
            nat (map (fn [x] (+ x 1 (inc -1))) [0 1 2])
            fib [{:key :value} 1 1 2 3 5 8 13 []]
        )
        (js/console.log "Hello, World!" nat [:x] almost-pi fib js/Math.PI)
    )

    </script>
    <script>

        const code = document.querySelector("#src").innerText;
        console.log(code);
        const ast = Lang.parse(code);
        console.log("AST", ast);
        const annotated = Lang.annotate(ast);
        console.log("annotated AST", annotated);
        const reconstructed = Lang.print(annotated);
        console.log(reconstructed);
        const generated = Lang.generate(annotated);
        console.log(generated);

        const script = document.createElement("script");
        script.appendChild(document.createTextNode(generated));
        document.body.appendChild(script);

    </script>
</body>

</html>